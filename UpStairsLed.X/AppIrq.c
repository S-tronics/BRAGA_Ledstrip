/*
 * File:   AppIrq.c
 * Author: stronics
 *
 * Created on 24 april 2021, 13:11
 */

/***********************************************************************************************************************
; I N C L U D E S
;---------------------------------------------------------------------------------------------------------------------*/
#include "..\Source\System\PIC16LF153x5\SysLibAll.h"
//Driver Include Section
#include "..\Source\Driver\PIC16LF153x5\DrvSci.h"
#include "..\Source\Driver\PIC16LF153x5\DrvI2C.h"
#include "..\Source\Driver\PIC16LF153x5\DrvTimer.h"
//Standard Include Section

//Application Include Section
#include "AppIrq.h"
/**********************************************************************************************************************/

/***********************************************************************************************************************
; V E R I F Y    C O N F I G U R A T I O N
;---------------------------------------------------------------------------------------------------------------------*/

/**********************************************************************************************************************/

/***********************************************************************************************************************
; L O C A L   D E F I N I T I O N S   A N D   M A C R O S
;---------------------------------------------------------------------------------------------------------------------*/
#define INT_INTGIE  0x80        //Interrupt Global Enable
#define INT_PEIE    0x40        //Interrupt Periphery Enable
#define INT_INT0IE  0x10        //Interrupt External Interrupt INT0

#define INT_INT0IF  0x02        //External Interrupt INT0 Flag
#define INT_INTEDG0 0x40        //External Interrupt Edge Select bit 

#define INT_TMR0IE  0x20        //Timer 0 Interrupt Enable
#define INT_TMR0IF  0x20        //Timer 0 Interrupt Flag

#define INT_TX1IE   0x10        //Uart1 TX Interrupt Enable
#define INT_TX1IF   0x10        //Uart1 TX Interrupt Flag
#define INT_RX1IE   0x20        //Uart1 RX Interrupt Enable
#define INT_RX1IF   0x20        //Uart1 RX Interrupt Flag

#define INT_SSP1IE  0x01        //SSP1 Interrupt Enable
#define INT_SSP1IF  0x01        //SSP1 Interrupt Flag

/**********************************************************************************************************************/

/***********************************************************************************************************************
; L O C A L   T Y P E D E F S
;---------------------------------------------------------------------------------------------------------------------*/

/**********************************************************************************************************************/

/***********************************************************************************************************************
; L O C A L   F U N C T I O N   P R O T O T Y P E S
;---------------------------------------------------------------------------------------------------------------------*/

/**********************************************************************************************************************/

/***********************************************************************************************************************
; L O C A L   V A R I A B L E S
;---------------------------------------------------------------------------------------------------------------------*/

/**********************************************************************************************************************/

/***********************************************************************************************************************
; E X P O R T E D   V A R I A B L E S
;---------------------------------------------------------------------------------------------------------------------*/

/**********************************************************************************************************************/



/***********************************************************************************************************************
; L O C A L   F U N C T I O N S
;---------------------------------------------------------------------------------------------------------------------*/

/**********************************************************************************************************************/



/***********************************************************************************************************************
; E X P O R T E D   F U N C T I O N S
;---------------------------------------------------------------------------------------------------------------------*/
void AppIrqInit(void)
{
    INTCON &= ~INT_INT0IF;   //Clear External Interrupt INT0 Flag
    //Enable Global Interrupt
    INTCON |= INT_INTGIE;
    INTCON |= INT_PEIE;

    //Timer 0 Interrupt Enable
    PIE0 |= INT_TMR0IE;
    PIR0 &= ~INT_TMR0IF;
    
    //Serial Communication UART1 Receive Interrupt Enable
    PIE1 |= INT_RX1IE;
    PIR1 &= ~INT_RX1IF;         //Clear Uart1 Rx Interrupt flag
    
    //I2C-Communication Interrupt Enable
    PIE3 |= INT_SSP1IE;
    PIR3 &= ~INT_SSP1IF;
}
/*--------------------------------------------------------------------------------------------------------------------*/
void AppIrqIntDisable(void)
{
    //INTCON &= ~INT_INTGIE;
    INTCON &= ~INT_PEIE;
}
/*--------------------------------------------------------------------------------------------------------------------*/
void AppIrqIntEnable(void)
{
    INTCON |= INT_PEIE;
}
/*--------------------------------------------------------------------------------------------------------------------*/
void __interrupt() AppIrqISR(void)
{
    //Everything arround interrupts
    if(PIR0 & INT_TMR0IF)
    {
        DrvTimerIsr();
        PIR0 &= ~INT_TMR0IF;
    }
    else if (PIR3 & INT_RX1IF)
    {
        DrvSciIntRec1();
        PIR3 &= ~INT_RX1IF;         //Clear Uart1 Rx Interrupt flag
    }
    else if(PIR3 & INT_SSP1IF)
    {
        DrvI2CIntRec();
        PIR3 &= ~INT_SSP1IF;
    }
}
/*--------------------------------------------------------------------------------------------------------------------*/

/**********************************************************************************************************************/


